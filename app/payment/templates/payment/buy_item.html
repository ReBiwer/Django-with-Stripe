{% extends 'payment/base.html' %}

{% block title %}
  {{ item.name }}
{% endblock %}

{% block body %}
  <div>
    <p>Name: {{ item.name }}</p>
    <p>Description: {{ item.description }}</p>
    <p>Price: {{ item.price }} $</p>
  </div>
  <div>
    <button class="buy-button">Buy</button>
  </div>
{% andblock %}

{% block script %}
<script type="text/javascript">
  var stripe = Stripe('pk_test_51QxNF9AL2OLARfzR3Jrk1O4qabzPA2IAN1SOXjeRsNR3CNIhv5v4b61zp6HerS7BWT30w41PUbAZZ5bOFVqk4J3j00EXOsaEnv');
  var buyButton = document.getElementById('buy-button');
  buyButton.addEventListener('click', function() {
    // Create a new Checkout Session using the server-side endpoint
    // Redirect to Stripe Session Checkout
    fetch('/buy/{{ item.id }}', {method: 'GET'})
    .then(response => return response.json())
    .then(session => stripe.redirectToCheckout({ sessionId: session.id }))
  });
</script>
{% endblock %}